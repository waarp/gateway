{{ define "head" }}
<title>{{ index .tab "title" }}</title>
<link rel="stylesheet" href="/webui/static/css/user_management_page.css">
<script src="/webui/static/javaScript/user_management_page.js"></script>
{{ end }}


{{ define "content" }}
    <h2>{{ index .tab "title" }}</h2>
    <hr class="mt-2 mb-4" style="border-top: 1px solid #ababab;">
    
    {{ if contains .myPermission.Users "w" }}
        <button class="btn btn-primary mb-3 btn-add" type="button" data-bs-toggle="modal" data-bs-target="#addUserModal">
        {{ index .tab "addUserTitle" }}
        </button>
        <div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
            <form method="get" class="p-3 border rounded bg-light">
                <div class="modal-header">
                <h5 class="modal-title" id="addUserModalLabel">{{ index .tab "addUserTitle" }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                <div class="form-input">
                    <label class="col-form-label">{{ index .tab "usernameStr" }} :</label>
                    <input type="text" name="newUserUsername" class="form-control" required>
                </div>
                <div class="form-input">
                    <label class="col-form-label mt-2">{{ index .tab "passwordStr" }} :</label>
                    <input type="password" name="newUserPassword" class="form-control" required>
                </div>
                <div class="mt-3 mb-3"><strong>{{ index .tab "permissions" }} :</strong></div>
                <div class="form-group">
                <label class="col-form-label mt-2">{{ index .tab "transfers" }} :</label>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="newUserPermissionsTransfers" id="transfers_r" value="r">
                        <label class="form-check-label" for="transfers_r">Read</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="newUserPermissionsTransfers" id="transfers_w" value="w">
                        <label class="form-check-label" for="transfers_w">Write</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="newUserPermissionsTransfers" id="transfers_d" value="d">
                        <label class="form-check-label" for="transfers_d">Delete</label>
                    </div>
                    </div>
                <div class="form-group">
                <label class="col-form-label mt-2">{{ index .tab "servers" }} :</label>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="newUserPermissionServers" id="servers_r" value="r">
                        <label class="form-check-label" for="servers_r">Read</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="newUserPermissionServers" id="servers_w" value="w">
                        <label class="form-check-label" for="servers_w">Write</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="newUserPermissionServers" id="servers_d" value="rd">
                        <label class="form-check-label" for="servers_d">Delete</label>
                    </div>
                    </div>
                <div class="form-group">
                <label class="col-form-label mt-2">{{ index .tab "partners" }} :</label>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="newUserPermissionsPartners" id="partners_r" value="r">
                        <label class="form-check-label" for="partners_r">Read</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="newUserPermissionsPartners" id="partners_w" value="w">
                        <label class="form-check-label" for="partners_w">Write</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="newUserPermissionsPartners" id="partners_d" value="d">
                        <label class="form-check-label" for="partners_d">Delete</label>
                    </div>
                    </div>
                <div class="form-group">
                <label class="col-form-label mt-2">{{ index .tab "rules" }} :</label>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="newUserPermissionsRules" id="rules_r" value="r">
                        <label class="form-check-label" for="rules_r">Read</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="newUserPermissionsRules" id="rules_w" value="w">
                        <label class="form-check-label" for="rules_w">Write</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="newUserPermissionsRules" id="rules_d" value="d">
                        <label class="form-check-label" for="rules_d">Delete</label>
                    </div>
                    </div>
                <div class="form-group">
                <label class="col-form-label mt-2">{{ index .tab "users" }} :</label>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="newUserPermissionsUsers" id="users_r" value="r">
                        <label class="form-check-label" for="users_r">Read</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="newUserPermissionsUsers" id="users_w" value="w">
                        <label class="form-check-label" for="users_w">Write</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="newUserPermissionsUsers" id="users_d" value="d">
                        <label class="form-check-label" for="users_d">Delete</label>
                    </div>
                    </div>
                <div class="form-group">
                <label class="col-form-label mt-2">{{ index .tab "administration" }} :</label>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="newUserPermissionsAdministration" id="administration_r" value="r">
                        <label class="form-check-label" for="administration_r">Read</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="newUserPermissionsAdministration" id="administration_w" value="w">
                        <label class="form-check-label" for="administration_w">Write</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="newUserPermissionsAdministration" id="administration_d" value="d">
                        <label class="form-check-label" for="administration_d">Delete</label>
                    </div>
                    </div>
                </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ index .tab "close" }}</button>
            <button type="submit" class="btn btn-success ms-3">{{ index .tab "apply" }}</button>
            </div>
        </form>
        </div>
    </div>
    </div>
    {{ end }}

    {{ if contains .myPermission.Users "r" }}
        <button class="btn btn-primary mb-3 ms-2 btn-filter" type="button" data-bs-toggle="collapse" data-bs-target="#filterCollapse" aria-expanded="false" aria-controls="filterCollapse">
        {{ index .tab "filter" }}
        </button>
        <div class="collapse" id="filterCollapse">
        <form method="get" class="p-3 border rounded bg-light">
            <label class="ms-3">{{ index .tab "sort" }}
            <select name="orderAsc" class="form-select d-inline w-auto">
                <option value="true">A → Z</option>
                <option value="false">Z → A</option>
            </select>
            </label>
            <label class="ms-3">{{ index .tab "limit" }}
            <select name="limit" class="form-select d-inline w-auto">
                <option value="0" disabled selected>--</option>
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="15">15</option>
                <option value="25">25</option>
                <option value="50">50</option>
            </select>
            </label>
            <label class="ms-3">{{ index .tab "permissions" }}: 
            <select id="permissions" name="permissions" class="form-select d-inline w-auto">
                <option value="" selected>--</option>
                <option value="filterPermissionsTransfers">Transfers</option>
                <option value="filterPermissionsServers">Servers</option>
                <option value="filterPermissionsPartners">Partners</option>
                <option value="filterPermissionsRules">Rules</option>
                <option value="filterPermissionsUsers">Users</option>
                <option value="filterPermissionsAdministration">Administration</option>
            </select>
            <select id="permissionsValue" name="permissionsValue" class="form-select d-inline w-auto">
                <option value="" selected>--</option>
                <option value="---">None</option>
                <option value="r--">R--</option>
                <option value="rw-">RW-</option>
                <option value="rwd">RWD</option>
            </select>
            </label>
            <button id="applyBtn" type="submit" class="btn btn-success ms-3">{{ index .tab "apply" }}</button>
        </form>
        </div>

        <table class="table table-sm align-middle mb-4 rounded-3 mt-3">
          <thead class="table-light">
            <tr>
              <th></th>
              <th>{{ index .tab "usernameStr" }}</th>
              <th>{{ index $.tab "transfers" }} <i class="bi bi-info-circle ms-1" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="transfers"></i></th>
              <th>{{ index $.tab "servers" }} <i class="bi bi-info-circle ms-1" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="servers"></i></th>
              <th>{{ index $.tab "partners" }} <i class="bi bi-info-circle ms-1" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="partners"></i></th>
              <th>{{ index $.tab "rules" }} <i class="bi bi-info-circle ms-1" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="rules"></i></th>
              <th>{{ index $.tab "users" }} <i class="bi bi-info-circle ms-1" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="users"></i></th>
              <th>{{ index $.tab "administration" }} <i class="bi bi-info-circle ms-1" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="administration"></i></th>
              <th class="text-end"></th>
            </tr>
          </thead>
          <tbody>
            {{ range .userPermissions }}
            <tr>
              <td><i class="bi bi-person-fill"></i></td>
              <td><strong>{{ .Username }}</strong></td>

              <td>{{ .Permissions.Transfers }}</td>
              <td>{{ .Permissions.Servers }}</td>
              <td>{{ .Permissions.Partners }}</td>
              <td>{{ .Permissions.Rules }}</td>
              <td>{{ .Permissions.Users }}</td>
              <td>{{ .Permissions.Administration }}</td>

              <td class="text-end">
                    {{ if contains $.myPermission.Users "w" }}
                        <button class="btn btn-outline-primary btn-sm me-1" data-bs-toggle="modal" data-bs-target="#editUserModal_{{ .ID }}">
                        <i class="bi bi-pencil"></i>
                        </button>
                        <div class="modal fade" id="editUserModal_{{ .ID }}" tabindex="-1" aria-labelledby="editUserModalLabel_{{ .ID }}" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                            <form method="get" class="p-3 border rounded bg-light">
                            <input type="hidden" name="editUserID" value="{{ .ID }}">
                            <div class="modal-header">
                            <h5 class="modal-title" id="editUserModalLabel">{{ index $.tab "edit" }}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">

                            <div class="form-input">
                                <label class="col-form-label">{{ index $.tab "usernameStr" }} :</label>
                                <input type="text" name="editUserUsername" class="form-control" required value="{{ .Username }}">
                            </div>
                            <div class="form-input">
                                <label class="col-form-label mt-2">{{ index $.tab "passwordStr" }} :</label>
                                <input type="password" name="editUserPassword" class="form-control">
                            </div>
                            <div class="title-perm mt-3 mb-3"><strong>{{ index $.tab "permissions" }} :</strong></div>
                                <div class="form-group">
                                    <label class="col-form-label mt-2">{{ index $.tab "transfers" }} :</label>
                                    <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="editUserPermissionsTransfers" id="edit_transfers_r" value="r" {{ if (contains .Permissions.Transfers "r") }}checked{{ end }}>
                                    <label class="form-check-label" for="edit_transfers_r">Read</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="editUserPermissionsTransfers" id="edit_transfers_w" value="w" {{ if (contains .Permissions.Transfers "w") }}checked{{ end }}>
                                    <label class="form-check-label" for="edit_transfers_w">Write-</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="editUserPermissionsTransfers" id="edit_transfers_d" value="d" {{ if (contains .Permissions.Transfers "d") }}checked{{ end }}>
                                    <label class="form-check-label" for="edit_transfers_d">Delete</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-form-label mt-2">{{ index $.tab "servers" }} :</label>
                                    <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="editUserPermissionsServers" id="edit_servers_r" value="r" {{ if (contains .Permissions.Transfers "r") }}checked{{ end }}>
                                    <label class="form-check-label" for="edit_servers_r">Read</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="editUserPermissionsServers" id="edit_servers_w" value="w" {{ if (contains .Permissions.Transfers "w") }}checked{{ end }}>
                                    <label class="form-check-label" for="edit_servers_w">Write</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="editUserPermissionsServers" id="edit_servers_d" value="d" {{ if (contains .Permissions.Transfers "d") }}checked{{ end }}>
                                    <label class="form-check-label" for="edit_servers_d">Delete</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-form-label mt-2">{{ index $.tab "partners" }} :</label>
                                    <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="editUserPermissionsPartners" id="edit_partners_r" value="r" {{ if (contains .Permissions.Transfers "r") }}checked{{ end }}>
                                    <label class="form-check-label" for="edit_partners_r">Read</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="editUserPermissionsPartners" id="edit_partners_w" value="w" {{ if (contains .Permissions.Transfers "w") }}checked{{ end }}>
                                    <label class="form-check-label" for="edit_partners_w">Write-</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="editUserPermissionsPartners" id="edit_partners_d" value="d" {{ if (contains .Permissions.Transfers "d") }}checked{{ end }}>
                                    <label class="form-check-label" for="edit_partners_d">Delete</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-form-label mt-2">{{ index $.tab "rules" }} :</label>
                                    <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="editUserPermissionsRules" id="edit_rules_r" value="r" {{ if (contains .Permissions.Transfers "r") }}checked{{ end }}>
                                    <label class="form-check-label" for="edit_rules_r">Read</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="editUserPermissionsRules" id="edit_rules_w" value="w" {{ if (contains .Permissions.Transfers "w") }}checked{{ end }}>
                                    <label class="form-check-label" for="edit_rules_w">Write-</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="editUserPermissionsRules" id="edit_rules_d" value="d" {{ if (contains .Permissions.Transfers "d") }}checked{{ end }}>
                                    <label class="form-check-label" for="edit_rules_d">Delete</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-form-label mt-2">{{ index $.tab "users" }} :</label>
                                    <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="editUserPermissionsUsers" id="edit_users_r" value="r" {{ if (contains .Permissions.Transfers "r") }}checked{{ end }}>
                                    <label class="form-check-label" for="edit_users_r">Read</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="editUserPermissionsUsers" id="edit_users_w" value="w" {{ if (contains .Permissions.Transfers "w") }}checked{{ end }}>
                                    <label class="form-check-label" for="edit_users_w">Write-</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="editUserPermissionsUsers" id="edit_users_d" value="d" {{ if (contains .Permissions.Transfers "d") }}checked{{ end }}>
                                    <label class="form-check-label" for="edit_users_d">Delete</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-form-label mt-2">{{ index $.tab "administration" }} :</label>
                                    <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="editUserPermissionsAdministration" id="edit_administration_r" value="r" {{ if (contains .Permissions.Transfers "r") }}checked{{ end }}>
                                    <label class="form-check-label" for="edit_administration_r">Read</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="editUserPermissionsAdministration" id="edit_administration_w" value="w" {{ if (contains .Permissions.Transfers "w") }}checked{{ end }}>
                                    <label class="form-check-label" for="edit_administration_w">Write-</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="editUserPermissionsAdministration" id="edit_administration_d" value="d" {{ if (contains .Permissions.Transfers "d") }}checked{{ end }}>
                                    <label class="form-check-label" for="edit_administration_d">Delete</label>
                                    </div>
                                </div>
                                </div>
                                <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ index $.tab "close" }}</button>
                                <button type="submit" class="btn btn-success ms-3">{{ index $.tab "apply" }}</button>
                                </div>
                            </form>
                            </div>
                        </div>
                        </div>
                    {{ end }}
                {{ if contains $.myPermission.Users "d" }}
                <form method="get" class="d-inline">
                  <input type="hidden" name="deleteUser" value="{{ .ID }}">
                  <button type="submit" class="btn btn-outline-danger btn-sm" onclick="confirm('Confirmer la suppression ?')">
                    <i class="bi bi-trash"></i>
                  </button>
                </form>
                {{ end }}
              </td>
            </tr>
            {{ end }}
          </tbody>
        </table>
    </div>
    {{ else }}
        <div class="row g-3 mb-4">
            <div class="row g-3 mb-4">
                <div class="col-sm-4">
                <div class="card text-center p-3">
                    <i class="bi bi-person-fill fs-2"></i>
                    <div><strong>{{ .username }}</strong></div>
                    <div>{{ index .tab "permissions" }}</div>
                    <div>{{ index .tab "transfers" }}: {{ .myPermission.Transfers }}</div>
                    <div>{{ index .tab "servers" }}: {{ .myPermission.Servers }}</div>
                    <div>{{ index .tab "partners" }}: {{ .myPermission.Partners }}</div>
                    <div>{{ index .tab "rules" }}: {{ .myPermission.Rules }}</div>
                    <div>{{ index .tab "users" }}: {{ .myPermission.Users }}</div>
                    <div>{{ index .tab "administration" }}: {{ .myPermission.Administration }}</div>
                </div>
                </div>
            </div>
        </div>
    {{ end }}
{{ end }}

{{ define "user_management_page" }}
  {{ template "index" . }}
{{ end }}
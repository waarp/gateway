CREATE TABLE IF NOT EXISTS `version` (`current` TEXT NOT NULL);
INSERT INTO `version` (`current`) VALUES ('0.4.0');
CREATE TABLE IF NOT EXISTS `crypto_credentials` (`id` INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, `owner_type` TEXT NOT NULL, `owner_id` INTEGER NOT NULL, `name` TEXT NOT NULL, `private_key` TEXT NULL, `certificate` TEXT NULL, `ssh_public_key` TEXT NULL);
CREATE UNIQUE INDEX `UQE_crypto_credentials_cert` ON `crypto_credentials` (`owner_type`,`owner_id`,`name`);
CREATE TABLE IF NOT EXISTS `transfer_history` (`id` INTEGER PRIMARY KEY NOT NULL, `owner` TEXT NOT NULL, `remote_transfer_id` TEXT NULL, `is_server` INTEGER NOT NULL, `is_send` INTEGER NOT NULL, `account` TEXT NOT NULL, `agent` TEXT NOT NULL, `protocol` TEXT NOT NULL, `source_filename` TEXT NOT NULL, `dest_filename` TEXT NOT NULL, `rule` TEXT NOT NULL, `start` TEXT NOT NULL, `stop` TEXT NULL, `status` TEXT NOT NULL, `error_code` TEXT NOT NULL, `error_details` TEXT NOT NULL, `step` TEXT NOT NULL, `progression` INTEGER NOT NULL, `task_number` INTEGER NOT NULL);
CREATE UNIQUE INDEX `UQE_transfer_history_histRemID` ON `transfer_history` (`remote_transfer_id`,`account`,`agent`);
CREATE TABLE IF NOT EXISTS `local_accounts` (`id` INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, `local_agent_id` INTEGER NOT NULL, `login` TEXT NOT NULL, `password_hash` TEXT NULL);
CREATE UNIQUE INDEX `UQE_local_accounts_loc_ac` ON `local_accounts` (`local_agent_id`,`login`);
CREATE TABLE IF NOT EXISTS `local_agents` (`id` INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, `owner` TEXT NOT NULL, `name` TEXT NOT NULL, `protocol` TEXT NOT NULL, `root` TEXT NOT NULL, `in_dir` TEXT NOT NULL, `out_dir` TEXT NOT NULL, `work_dir` TEXT NOT NULL, `proto_config` BLOB NOT NULL, `address` TEXT NOT NULL);
CREATE UNIQUE INDEX `UQE_local_agents_loc_ag` ON `local_agents` (`owner`,`name`);
CREATE TABLE IF NOT EXISTS `remote_accounts` (`id` INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, `remote_agent_id` INTEGER NOT NULL, `login` TEXT NOT NULL, `password` TEXT NULL);
CREATE UNIQUE INDEX `UQE_remote_accounts_rem_ac` ON `remote_accounts` (`remote_agent_id`,`login`);
CREATE TABLE IF NOT EXISTS `remote_agents` (`id` INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, `name` TEXT NOT NULL, `protocol` TEXT NOT NULL, `proto_config` BLOB NOT NULL, `address` TEXT NOT NULL);
CREATE UNIQUE INDEX `UQE_remote_agents_name` ON `remote_agents` (`name`);
CREATE TABLE IF NOT EXISTS `rules` (`id` INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, `name` TEXT NOT NULL, `comment` TEXT NOT NULL, `send` INTEGER NOT NULL, `path` TEXT NOT NULL, `in_path` TEXT NOT NULL, `out_path` TEXT NOT NULL, `work_path` TEXT NOT NULL);
CREATE UNIQUE INDEX `UQE_rules_path` ON `rules` (`send`,`path`);
CREATE UNIQUE INDEX `UQE_rules_dir` ON `rules` (`name`,`send`);
CREATE TABLE IF NOT EXISTS `rule_access` (`rule_id` INTEGER NOT NULL, `object_id` INTEGER NOT NULL, `object_type` TEXT NOT NULL);
CREATE UNIQUE INDEX `UQE_rule_access_perm` ON `rule_access` (`rule_id`,`object_id`,`object_type`);
CREATE TABLE IF NOT EXISTS `tasks` (`rule_id` INTEGER NOT NULL, `chain` TEXT NOT NULL, `rank` INTEGER NOT NULL, `type` TEXT NOT NULL, `args` BLOB NOT NULL);
CREATE TABLE IF NOT EXISTS `transfers` (`id` INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, `remote_transfer_id` TEXT NOT NULL, `rule_id` INTEGER NOT NULL, `is_server` INTEGER NOT NULL, `agent_id` INTEGER NOT NULL, `account_id` INTEGER NOT NULL, `true_filepath` TEXT NOT NULL, `source_file` TEXT NOT NULL, `dest_file` TEXT NOT NULL, `start` TEXT NOT NULL, `step` TEXT NOT NULL, `status` TEXT NOT NULL, `owner` TEXT NOT NULL, `progression` INTEGER NOT NULL, `task_number` INTEGER NOT NULL, `error_code` TEXT NOT NULL, `error_details` TEXT NOT NULL);
CREATE TABLE IF NOT EXISTS `transfer_info` (`transfer_id` INTEGER NOT NULL, `name` TEXT NOT NULL, `value` TEXT NOT NULL);
CREATE UNIQUE INDEX `UQE_transfer_info_infoName` ON `transfer_info` (`transfer_id`,`name`);
CREATE TABLE IF NOT EXISTS `users` (`id` INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, `owner` TEXT NOT NULL, `username` TEXT NOT NULL, `password` BLOB NOT NULL, `permissions` BLOB NOT NULL);
CREATE UNIQUE INDEX `UQE_users_name` ON `users` (`owner`,`username`);
.. _ref-fs-s3:

=========
Amazon S3
=========

Pour qu'un fichier soit déposé et/ou lu depuis un serveur cloud de type S3, il
faut que le chemin complet du fichier (après concaténation des éventuels chemins
de règle et/ou de serveur) forme un URL.

Cet URL doit utiliser le schéma ``s3``, et l'hôte doit être le nom de l'instance
cloud sur laquelle le fichier doit être lu/écrit.

Options
-------

La *Gateway* permet de stocker les fichier envoyés et reçu sur un serveur cloud
de stockage S3 (AWS ou autre). Pour cela, l'instance cloud à créer doit contenir
les options suivantes :

* **bucket**: Le nom du bucket dans lequel le fichier sera déposé.
* **region**: La région du serveur S3.
* **endpoint**: L'adresse du serveur S3.
* **no-tls**: *Booléen* - Si vrai, le client utilisera HTTP au lieu de HTTPS.

Exemple
-------

Prenons le cas de figure suivant :

  - fichier: ``doc/waarp-gateway.pdf``
  - bucket: ``archive``
  - point de terminaison: ``s3.eu-west-3.amazonaws.com``
  - région: ``eu-west-3`` (Paris)
  - clé d'accès: ``toto``
  - clé d'accès secrète: ``sesame``
  - protocole: HTTP clair

Dans un premier temps, l'instance cloud doit être définie. Dans cet exemple, nous
lui donnerons le nom "instance-exemple".

La commande de création pour cette instance cloud est donc :

.. code-block:: shell
   waarp-gateway cloud add -n "instance-exemple" -t "s3" -k "toto" -s "sesame" -o "bucket:archive" -o "region:eu-west-3" -o "endpoint:s3.eu-west-3.amazonaws.com" -o "no-tls:true"

Par la suite, lors de mon transfert, le chemin du fichier devra donc ressembler à : ::

    s3://instance-exemple/doc/waarp-gateway.pdf
